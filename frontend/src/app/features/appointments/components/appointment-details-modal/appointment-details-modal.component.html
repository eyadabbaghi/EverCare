<div class="fixed inset-0 z-50 flex items-center justify-center p-4">
  <div class="fixed inset-0 bg-black/50" (click)="onClose.emit()"></div>

  <div class="relative bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6">
      <!-- Header -->
      <div class="flex justify-between items-start mb-4">
        <h2 class="text-xl font-semibold text-[#2D1B4E]">Appointment Details</h2>
        <button class="p-1 hover:bg-[#F3E8FF] rounded-full" (click)="onClose.emit()">
          <svg class="w-5 h-5 text-[#6B5B8C]" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div *ngIf="appointment" class="space-y-4">
        <!-- Patient Info -->
        <div class="bg-[#F9FAFB] p-4 rounded-lg">
          <div class="flex items-center space-x-4 mb-4">
            <img [src]="appointment.patientPhoto" class="w-16 h-16 rounded-full">
            <div>
              <h3 class="font-semibold text-lg text-[#2D1B4E]">{{ appointment.patientName }}</h3>
              <p class="text-sm text-[#6B5B8C]">Born: {{ patientBirthDate | date:'dd/MM/yyyy' }} ({{ patientAge }} years)</p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-xs text-[#6B5B8C]">Alzheimer Stage</p>
              <p class="font-medium">{{ patientAlzheimerStage || 'MODERE' }}</p>
            </div>
            <div>
              <p class="text-xs text-[#6B5B8C]">Caregiver</p>
              <p class="font-medium">{{ appointment.caregiverName || 'None' }}</p>
            </div>
            <div>
              <p class="text-xs text-[#6B5B8C]">Emergency Contact</p>
              <p class="font-medium">{{ emergencyContact || 'Not provided' }}</p>
            </div>
            <div>
              <p class="text-xs text-[#6B5B8C]">Previous Visits</p>
              <p class="font-medium">{{ previousVisits || 12 }} consultations</p>
            </div>
          </div>
        </div>

        <!-- Appointment Info -->
        <div class="border-t pt-4">
          <h4 class="font-medium text-[#2D1B4E] mb-3">Appointment Information</h4>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-xs text-[#6B5B8C]">Date & Time</p>
              <p class="font-medium">{{ appointment.startDateTime | date:'dd/MM/yyyy HH:mm' }}</p>
            </div>
            <div>
              <p class="text-xs text-[#6B5B8C]">Duration</p>
              <p class="font-medium">{{ getDuration() }} minutes</p>
            </div>
            <div>
              <p class="text-xs text-[#6B5B8C]">Type</p>
              <p class="font-medium">{{ appointment.consultationTypeName }}</p>
            </div>
            <div>
              <p class="text-xs text-[#6B5B8C]">Status</p>
              <span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium"
                    [class]="getStatusClass(appointment.status)">
                    {{ getStatusLabel(appointment.status) }}
                  </span>
            </div>
          </div>
        </div>

        <!-- Medical Notes Section -->
        <div class="border-t pt-4">
          <div class="flex justify-between items-center mb-3">
            <h4 class="font-medium text-[#2D1B4E]">Medical Notes</h4>
            <button class="text-sm text-[#7C3AED] hover:underline" (click)="onEditNotes.emit()">Edit</button>
          </div>
          <textarea
            [ngModel]="appointment.doctorNotes"
            (ngModelChange)="onNotesChange.emit($event)"
            rows="4"
            class="w-full px-3 py-2 border border-[#E2E8F0] rounded-md focus:outline-none focus:ring-2 focus:ring-[#7C3AED]"
            placeholder="Add your medical notes here...">
              </textarea>
        </div>

        <!-- Cognitive Markers -->
        <div class="border-t pt-4">
          <h4 class="font-medium text-[#2D1B4E] mb-3">Cognitive Markers (Last Visit)</h4>
          <div class="space-y-2">
            <div class="flex items-center justify-between">
              <span class="text-sm text-[#6B5B8C]">MMSE Score</span>
              <span class="font-medium">22/30 (-1 vs previous)</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-[#6B5B8C]">Confusion Episodes</span>
              <span class="font-medium">3 in last week</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-[#6B5B8C]">Medication Adherence</span>
              <span class="font-medium text-green-600">85%</span>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="border-t pt-4 flex justify-end space-x-3">
          <button *ngIf="showStartButton"
                  class="px-4 py-2 bg-[#7C3AED] text-white rounded-md hover:bg-[#6D28D9]"
                  (click)="onStart.emit(appointment)">
            Start Consultation
          </button>
          <button class="px-4 py-2 border border-[#7C3AED] text-[#7C3AED] rounded-md hover:bg-[#F3E8FF]"
                  (click)="onPrescribe.emit()">
            Prescribe
          </button>
          <button class="px-4 py-2 border border-[#E2E8F0] rounded-md hover:bg-[#F3E8FF]"
                  (click)="onClose.emit()">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
