<div class="min-h-screen bg-gradient-to-br from-[#FAF8FC] to-[#F3E8FF] p-6">
  <div class="max-w-6xl mx-auto space-y-6">
    <!-- Header -->
    <header class="flex items-center justify-between gap-4">
      <div>
        <h1 class="text-3xl font-bold text-[#2D1B4E] mb-1">
          Users management
        </h1>
        <p class="text-sm text-[#6B5B8C]">
          Manage platform users, their roles, and access status.
        </p>
      </div>

      <button
        type="button"
        class="inline-flex items-center px-4 py-2 rounded-full bg-[#7C3AED] text-white text-sm font-medium shadow-sm hover:bg-[#6D28D9] transition-colors"
        (click)="startCreate()"
      >
        <span class="mr-2 text-lg">＋</span>
        New user
      </button>
    </header>

    <!-- Loading indicator -->
    <div *ngIf="loading" class="text-center py-4">
      <span class="text-[#6B5B8C]">Loading users...</span>
    </div>

    <!-- Users table -->
    <section *ngIf="!loading" class="rounded-2xl bg-white border border-[#E5D9FF] p-5 space-y-4">
      <div class="flex items-center justify-between text-sm">
        <h2 class="text-sm font-semibold text-[#2D1B4E]">
          Users
        </h2>
        <p class="text-xs text-[#6B5B8C]">
          {{ users.length }} users in this environment
        </p>
      </div>

      <div class="overflow-x-auto rounded-xl border border-[#E5E7EB]">
        <table class="min-w-full text-sm">
          <thead class="bg-[#F3E8FF] text-[#4B5563]">
            <tr>
              <th class="px-4 py-2 text-left font-medium">Name</th>
              <th class="px-4 py-2 text-left font-medium">Email</th>
              <th class="px-4 py-2 text-left font-medium">Role</th>
              <th class="px-4 py-2 text-left font-medium">Verified</th>
              <th class="px-4 py-2 text-right font-medium">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let user of pagedUsers"
              class="border-t border-[#E5E7EB] hover:bg-[#F9FAFB]"
            >
              <td class="px-4 py-2 align-middle">
                <div class="flex items-center gap-2">
                  <div
                    class="w-8 h-8 rounded-full bg-[#C4B5FD] flex items-center justify-center text-xs font-semibold text-[#7C3AED] overflow-hidden"
                  >
                    <ng-container *ngIf="user.profilePicture; else initials">
                      <img [src]="user.profilePicture" alt="Profile" class="w-full h-full object-cover">
                    </ng-container>
                    <ng-template #initials>
                      <span>{{ getInitials(user.name) }}</span>
                    </ng-template>
                  </div>
                  <div class="flex flex-col">
                    <span class="font-medium text-[#111827]">
                      {{ user.name || 'Unnamed user' }}
                    </span>
                    <span class="text-[11px] text-[#6B5B8C]">
                      {{ user.userId }}
                    </span>
                  </div>
                </div>
              </td>
              <td class="px-4 py-2 align-middle">
                <span class="text-[#374151]">{{ user.email }}</span>
              </td>
              <td class="px-4 py-2 align-middle">
                <select
                  [(ngModel)]="user.role"
                  class="text-xs rounded-full border border-[#E5E7EB] bg-white px-3 py-1 focus:outline-none focus:ring-2 focus:ring-[#C4B5FD]"
                >
                  <option *ngFor="let role of roles" [value]="role">
                    {{ role }}
                  </option>
                </select>
              </td>
              <td class="px-4 py-2 align-middle">
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium"
                  [ngClass]="user.isVerified ? 'bg-emerald-50 text-emerald-700 border border-emerald-200' : 'bg-slate-50 text-slate-600 border border-slate-200'"
                >
                  <span
                    class="w-2 h-2 rounded-full mr-2"
                    [ngClass]="user.isVerified ? 'bg-emerald-500' : 'bg-slate-400'"
                  ></span>
                  {{ user.isVerified ? 'Verified' : 'Not verified' }}
                </span>
              </td>
              <td class="px-4 py-2 align-middle text-right">
                <button
                  type="button"
                  class="text-xs text-[#7C3AED] hover:text-[#6D28D9] mr-3"
                  (click)="startEdit(user)"
                >
                  Edit
                </button>
                <button
                  type="button"
                  class="text-xs text-rose-600 hover:text-rose-700"
                  (click)="deleteUser(user)"
                >
                  Delete
                </button>
              </td>
            </tr>
            <tr *ngIf="!users.length">
              <td
                colspan="5"
                class="px-4 py-6 text-center text-xs text-[#6B5B8C]"
              >
                No users yet. Click <span class="font-semibold">New user</span> to add one.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Create / Edit drawer-style form -->
    <section
      *ngIf="isCreating || editingUser"
      class="rounded-2xl bg-white border border-[#E5D9FF] p-5 space-y-4"
    >
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-sm font-semibold text-[#2D1B4E]">
            {{ isCreating ? 'Create user' : 'Edit user' }}
          </h2>
          <p class="text-xs text-[#6B5B8C]">
            Core identity and access role for this user.
          </p>
        </div>
        <button
          type="button"
          class="text-sm text-[#6B5B8C] hover:text-[#111827]"
          (click)="cancelForm()"
        >
          ✕
        </button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
        <label class="space-y-1">
          <span class="text-xs font-medium text-[#4B5563]">Full name</span>
          <input
            type="text"
            [(ngModel)]="newUser.name"
            name="name"
            class="w-full rounded-xl border border-[#E5E7EB] px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#C4B5FD]"
            placeholder="Jane Doe"
            [disabled]="!isCreating && !editingUser"
          />
        </label>

        <label class="space-y-1">
          <span class="text-xs font-medium text-[#4B5563]">Email</span>
          <input
            type="email"
            [(ngModel)]="newUser.email"
            name="email"
            class="w-full rounded-xl border border-[#E5E7EB] px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#C4B5FD]"
            placeholder="jane.doe@example.com"
            [disabled]="!isCreating && !editingUser"
          />
        </label>

        <label class="space-y-1">
          <span class="text-xs font-medium text-[#4B5563]">Role</span>
          <select
            [(ngModel)]="newUser.role"
            name="role"
            class="w-full rounded-xl border border-[#E5E7EB] px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#C4B5FD]"
          >
            <option *ngFor="let role of roles" [value]="role">
              {{ role }}
            </option>
          </select>
        </label>
      </div>

      <div class="flex items-center justify-end gap-2 pt-2">
        <button
          type="button"
          class="px-4 py-2 rounded-full border border-[#E5E7EB] text-xs text-[#374151]"
          (click)="cancelForm()"
        >
          Cancel
        </button>
        <button
          type="button"
          class="px-4 py-2 rounded-full bg-[#7C3AED] text-white text-xs font-medium shadow-sm hover:bg-[#6D28D9]"
          [disabled]="!newUser.name || !newUser.email"
          (click)="saveUser()"
        >
          {{ isCreating ? 'Create user' : 'Save changes' }}
        </button>
      </div>
    </section>
  </div>
</div>