<nav class="bg-white border-b border-[#C4B5FD] sticky top-0 z-40 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">

      <!-- Logo -->
      <button
        type="button"
        class="flex items-center space-x-3 cursor-pointer"
        (click)="navigate('/')"
      >
        <img
          src="/logo.png"
          alt="EverCare logo"
          class="h-9 w-9 rounded-xl object-contain"
        />
        <span class="text-xl font-bold text-[#2D1B4E]">EverCare</span>
      </button>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-1">

        <!-- Activities -->
        <button
          type="button"
          (click)="navigate('/activities')"
          [ngClass]="isActive('/activities')
            ? 'bg-[#F3E8FF] text-[#7C3AED]'
            : 'text-[#6B5B8C] hover:bg-[#F3E8FF] hover:text-[#7C3AED]'"
          class="flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition"
        >
          <!-- New activity SVG -->
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path clip-rule="evenodd" d="m9.61954 6.62394c-.01804.0188-.08318.0875-.19772.27449-.17279.28208-.38002.69503-.68529 1.30558l-1.62348 3.24699c-.0106.0212-.02123.0425-.03191.064-.12656.2547-.26165.5266-.47467.7352-.18531.1815-.40866.3196-.65388.4042-.28187.0972-.58546.0964-.86986.0957-.02401 0-.04788-.0001-.07158-.0001h-2.01115c-.41421 0-.75-.3358-.75-.75s.33579-.75.75-.75h2.01115c.18855 0 .29609-.0003.37695-.0054.04979-.0031.07052-.0071.07597-.0085.03461-.012.06614-.0315.09238-.057.00362-.0043.01652-.0211.04157-.0642.04067-.0701.08906-.1661.17339-.3348l1.63973-3.27941c.28491-.56985.52083-1.04172.73158-1.38578.19655-.32087.46988-.70707.89812-.87676.53844-.21335 1.14756-.14648 1.62686.17859.3813.25854.5643.69484.6866 1.05071.1311.38159.259.89341.4135 1.5115l1.4076 5.63025c.2311.9246.3944 1.5756.5429 2.0253.0739.2239.1336.3643.1801.4486.0065.0117.0122.0213.0169.029.0547.0197.1147.0197.1694 0 .0047-.0077.0104-.0173.0169-.029.0465-.0843.1062-.2247.1801-.4486.1485-.4497.3118-1.1007.5429-2.0253l.1448-.5791c.0073-.029.0145-.0582.0217-.0876.0842-.3413.1738-.7042.3889-.9914.1865-.2491.436-.4439.7229-.5645.3308-.1389.7046-.1378 1.0561-.1368.0303.0001.0604.0002.0902.0002h3.7508c.4142 0 .75.3358.75.75s-.3358.75-.75.75h-3.7508c-.234 0-.37.0005-.4716.0078-.0622.0045-.0882.0104-.0951.0123-.0399.0171-.0747.0442-.1009.0788-.0035.0062-.0156.03-.035.0893-.0318.0968-.0652.2286-.122.4557l-.1531.6126c-.2209.8836-.3973 1.5892-.5654 2.0982-.0854.2587-.1791.5002-.2915.7036-.1085.1965-.2717.4271-.5294.5782-.5466.3205-1.2238.3205-1.7704 0-.2577-.1511-.4209-.3817-.5294-.5782-.1124-.2034-.2061-.4449-.2915-.7036-.1681-.509-.3445-1.2146-.5654-2.0982l-1.4071-5.62852c-.1655-.66223-.2783-1.1103-.38575-1.42315-.07124-.20738-.11993-.28857-.13346-.31084-.05611-.02962-.12145-.03679-.18265-.02005zm6.96316 6.22326c0-.0001-.0004.0008-.0011.0017zm.0978-.0764c0-.0001.0009-.0003.002-.0007zm-2.7465 3.3686s-.0002-.0003-.0007-.0009zm-8.37863-4.9592c.00001 0 .00043-.0005.00108-.0011z" fill="#000000" fill-rule="evenodd"></path>
          </svg>
          Activities
        </button>

        <!-- Alerts -->
        <button
          type="button"
          (click)="navigate('/alerts')"
          [ngClass]="isActive('/alerts')
            ? 'bg-[#F3E8FF] text-[#7C3AED]'
            : 'text-[#6B5B8C] hover:bg-[#F3E8FF] hover:text-[#7C3AED]'"
          class="flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
              d="M12 9v2m0 4h.01M10.29 3.86l-7.4 12.8A1 1 0 003.7 18h16.6a1 1 0 00.81-1.54l-7.4-12.8a1 1 0 00-1.72 0z"/>
          </svg>
          Alerts
        </button>

        <!-- Appointment -->
        <button
          type="button"
          (click)="navigate('/appointments')"
          [ngClass]="isActive('/appointments')
            ? 'bg-[#F3E8FF] text-[#7C3AED]'
            : 'text-[#6B5B8C] hover:bg-[#F3E8FF] hover:text-[#7C3AED]'"
          class="flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7H3v12a2 2 0 002 2z"/>
          </svg>
          Appointment
        </button>

        <!-- Medical Folder -->
        <button
          type="button"
          (click)="navigate('/medical-folder')"
          [ngClass]="isActive('/medical-folder')
            ? 'bg-[#F3E8FF] text-[#7C3AED]'
            : 'text-[#6B5B8C] hover:bg-[#F3E8FF] hover:text-[#7C3AED]'"
          class="flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
              d="M3 7a2 2 0 012-2h4l2 2h8a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/>
          </svg>
          Medical Folder
        </button>

        <!-- Blog -->
        <button
          type="button"
          (click)="navigate('/blog')"
          [ngClass]="isActive('/blog')
            ? 'bg-[#F3E8FF] text-[#7C3AED]'
            : 'text-[#6B5B8C] hover:bg-[#F3E8FF] hover:text-[#7C3AED]'"
          class="flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
              d="M19 21H5a2 2 0 01-2-2V7l4-4h12a2 2 0 012 2v14a2 2 0 01-2 2z"/>
          </svg>
          Blog
        </button>

        <!-- Messages -->
        <button
          type="button"
          (click)="navigate('/messages')"
          [ngClass]="isActive('/messages')
            ? 'bg-[#F3E8FF] text-[#7C3AED]'
            : 'text-[#6B5B8C] hover:bg-[#F3E8FF] hover:text-[#7C3AED]'"
          class="flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
              d="M8 10h8M8 14h6M21 12c0 4-4 8-9 8a9.8 9.8 0 01-4-.8L3 21l1.8-4A8 8 0 1112 4c5 0 9 4 9 8z"/>
          </svg>
          Messages
        </button>

        <!-- Daily Me -->
        <button
          type="button"
          (click)="navigate('/daily')"
          [ngClass]="isActive('/daily')
            ? 'bg-[#F3E8FF] text-[#7C3AED]'
            : 'text-[#6B5B8C] hover:bg-[#F3E8FF] hover:text-[#7C3AED]'"
          class="flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Daily Me
        </button>
      </div>

      <!-- Right Section -->
      <div class="flex items-center space-x-3">

        <!-- Notifications -->
        <div class="relative">
          <button
            type="button"
            class="relative inline-flex items-center justify-center w-9 h-9 rounded-full hover:bg-[#F3E8FF]"
            (click)="openAlerts()"
          >
            <svg class="w-5 h-5 text-[#7C3AED]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
                d="M15 17h5l-1.4-1.4A2 2 0 0118 14V11a6 6 0 10-12 0v3a2 2 0 01-.6 1.6L4 17h5m6 0a3 3 0 11-6 0"/>
            </svg>
            <span
              *ngIf="unreadCount > 0"
              class="absolute -top-1 -right-1 w-5 h-5 bg-[#C06C84] rounded-full text-white text-xs flex items-center justify-center font-semibold"
            >
              {{ unreadCount }}
            </span>
          </button>

          <!-- Notifications Dropdown -->
          <div
            *ngIf="notificationsOpen"
            class="absolute right-0 mt-2 w-80 max-w-[calc(100vw-2rem)] bg-white border border-[#E5E7EB] rounded-xl shadow-lg overflow-hidden z-50"
          >
            <div class="px-4 py-2 flex items-center justify-between">
              <span class="text-sm font-semibold text-[#2D1B4E]">Notifications</span>
              <button
                type="button"
                class="text-xs text-[#7C3AED] hover:underline"
                *ngIf="unreadCount > 0"
                (click)="markAllAsRead()"
              >
                Mark all as read
              </button>
            </div>
            <div class="border-t border-[#E5E7EB] max-h-80 overflow-y-auto">
              <ng-container *ngIf="notifications.length; else noNotifications">
                <button
                  type="button"
                  *ngFor="let n of notifications"
                  class="w-full text-left px-4 py-3 border-b border-[#E5E7EB] last:border-0 hover:bg-[#F9FAFB] flex gap-3"
                  [ngClass]="{ 'bg-[#F3E8FF]': !n.read }"
                  (click)="handleNotificationClick(n)"
                >
                  <div class="mt-1">
                    <span *ngIf="n.type === 'alert'">‚ö†Ô∏è</span>
                    <span *ngIf="n.type === 'appointment'">üìÖ</span>
                    <span *ngIf="n.type === 'medication'">üíä</span>
                    <span *ngIf="n.type === 'message'">üí¨</span>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-start justify-between gap-2 mb-1">
                      <p class="text-xs font-semibold text-[#2D1B4E]">
                        {{ n.title }}
                      </p>
                      <span
                        *ngIf="n.severity"
                        class="text-[10px] px-2 py-0.5 rounded-full"
                        [ngClass]="getSeverityClasses(n.severity)"
                      >
                        {{ n.severity }}
                      </span>
                    </div>
                    <p class="text-xs text-[#6B5B8C] line-clamp-2">
                      {{ n.message }}
                    </p>
                    <p class="text-[10px] text-[#9CA3AF] mt-1">
                      {{ n.time }}
                    </p>
                  </div>
                </button>
              </ng-container>
              <ng-template #noNotifications>
                <div class="py-6 text-center text-[#6B5B8C] text-sm">
                  No notifications
                </div>
              </ng-template>
            </div>
            <button
              type="button"
              class="w-full text-center text-xs text-[#7C3AED] py-2 hover:bg-[#F3E8FF]"
              (click)="navigate('/alerts')"
            >
              View all alerts
            </button>
          </div>
        </div>

 <!-- User dropdown -->
<div *ngIf="user" class="hidden md:flex items-center space-x-2 relative">

  <button
    id="profile-button"
    type="button"
    class="flex items-center space-x-2 px-2 py-1 rounded-full hover:bg-[#F3E8FF] transition-all duration-200"
    (click)="toggleProfileMenu()"
  >
    <!-- Avatar -->
    <div class="w-9 h-9 rounded-full bg-[#C4B5FD] flex items-center justify-center text-sm font-semibold overflow-hidden">
      <ng-container *ngIf="user.profilePicture; else initials">
        <img [src]="user.profilePicture" alt="Profile" class="w-full h-full object-cover">
      </ng-container>
      <ng-template #initials>
        <span class="text-[#7C3AED]">{{ getInitials(user.name) }}</span>
      </ng-template>
    </div>

    <!-- Name & Role -->
    <div class="flex flex-col text-left">
      <span class="text-sm font-medium text-[#2D1B4E]">{{ user.name }}</span>
      <span class="text-[11px] text-[#6B5B8C] capitalize">{{ user.role }}</span>
    </div>
  </button>

  <!-- Profile Dropdown -->
  <div
    id="profile-dropdown"
    *ngIf="profileOpen"
    class="absolute right-0 mt-2 w-64 bg-white border border-[#E5E7EB] rounded-xl shadow-lg overflow-hidden z-50 transition-all duration-200"
  >
    <button
      class="w-full text-left px-4 py-2.5 text-sm text-[#2D1B4E] hover:bg-[#F3E8FF] flex items-center gap-2"
      (click)="goToProfile()"
    >
      <svg class="w-4 h-4 text-[#7C3AED]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M14.3365 12.3466L14.0765 11.9195C13.9082 12.022 13.8158 12.2137 13.8405 12.4092C13.8651 12.6046 14.0022 12.7674 14.1907 12.8249L14.3365 12.3466ZM9.6634 12.3466L9.80923 12.8249C9.99769 12.7674 10.1348 12.6046 10.1595 12.4092C10.1841 12.2137 10.0917 12.022 9.92339 11.9195L9.6634 12.3466ZM4.06161 19.002L3.56544 18.9402L4.06161 19.002ZM19.9383 19.002L20.4345 18.9402L19.9383 19.002ZM16 8.5C16 9.94799 15.2309 11.2168 14.0765 11.9195L14.5965 12.7737C16.0365 11.8971 17 10.3113 17 8.5H16ZM12 4.5C14.2091 4.5 16 6.29086 16 8.5H17C17 5.73858 14.7614 3.5 12 3.5V4.5ZM7.99996 8.5C7.99996 6.29086 9.79082 4.5 12 4.5V3.5C9.23854 3.5 6.99996 5.73858 6.99996 8.5H7.99996ZM9.92339 11.9195C8.76904 11.2168 7.99996 9.948 7.99996 8.5H6.99996C6.99996 10.3113 7.96342 11.8971 9.40342 12.7737L9.92339 11.9195ZM9.51758 11.8683C6.36083 12.8309 3.98356 15.5804 3.56544 18.9402L4.55778 19.0637C4.92638 16.1018 7.02381 13.6742 9.80923 12.8249L9.51758 11.8683ZM3.56544 18.9402C3.45493 19.8282 4.19055 20.5 4.99996 20.5V19.5C4.70481 19.5 4.53188 19.2719 4.55778 19.0637L3.56544 18.9402ZM4.99996 20.5H19V19.5H4.99996V20.5ZM19 20.5C19.8094 20.5 20.545 19.8282 20.4345 18.9402L19.4421 19.0637C19.468 19.2719 19.2951 19.5 19 19.5V20.5ZM20.4345 18.9402C20.0164 15.5804 17.6391 12.8309 14.4823 11.8683L14.1907 12.8249C16.9761 13.6742 19.0735 16.1018 19.4421 19.0637L20.4345 18.9402Z" fill="#000000"></path>
      </svg>
      My Profile
    </button>

    <button
      class="w-full text-left px-4 py-2 text-sm text-[#C06C84] hover:bg-red-50 flex items-center gap-2 border-t border-[#F3E8FF]"
      (click)="logout()"
    >
      <svg class="w-4 h-4 text-[#C06C84]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
          d="M17 16l4-4m0 0l-4-4m4 4H7"/>
      </svg>
      Log out
    </button>
  </div>
</div>


        <!-- Log In Button -->
        <div *ngIf="!user" class="hidden md:block">
          <button
            type="button"
            class="flex items-center gap-2 px-3 py-2 rounded-full bg-[#7C3AED] text-white text-sm font-medium hover:bg-[#6D28D9]"
            (click)="navigate('/login')"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
                d="M15 12H3m0 0l4-4m-4 4l4 4m6-12h6v18h-6"/>
            </svg>
            Log In
          </button>
        </div>

        <!-- Mobile Menu Toggle -->
        <button
          type="button"
          class="md:hidden inline-flex items-center justify-center w-9 h-9 rounded-full hover:bg-[#F3E8FF]"
          (click)="toggleMobileMenu()"
        >
          <span *ngIf="!isMobileMenuOpen">‚ò∞</span>
          <span *ngIf="isMobileMenuOpen">‚úï</span>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div *ngIf="isMobileMenuOpen" class="md:hidden border-t border-[#C4B5FD] bg-white px-4 pb-4 space-y-2">
      <button
        *ngFor="let item of navItems"
        type="button"
        class="w-full flex items-center justify-start px-3 py-2 rounded-md text-sm font-medium"
        [ngClass]="isActive(item.route)
          ? 'bg-[#F3E8FF] text-[#7C3AED]'
          : 'text-[#6B5B8C] hover:bg-[#F3E8FF] hover:text-[#7C3AED]'"
        (click)="navigate(item.route)"
      >
        {{ item.label }}
      </button>

      <!-- Mobile User -->
      <div *ngIf="user" class="border-t border-[#E5E7EB] pt-2 mt-2">
        <div class="px-3 py-2 text-sm text-[#2D1B4E] font-medium">
          {{ user.name }} - {{ user.role }}
        </div>
        <button
          type="button"
          class="w-full flex items-center justify-start px-3 py-2 text-sm text-[#C06C84] hover:bg-red-50"
          (click)="logout()"
        >
          Log out
        </button>
      </div>
      <div *ngIf="!user" class="border-t border-[#E5E7EB] pt-2 mt-2">
        <button
          type="button"
          class="w-full flex items-center justify-start px-3 py-2 text-sm text-[#7C3AED]"
          (click)="navigate('/login')"
        >
          Log In
        </button>
      </div>
    </div>

  </div>
</nav>
